<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CropCart | Account</title>

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link href="./styles/style.css" rel="stylesheet" />

    <!-- App config + helpers -->
    <script src="./scripts/config.js"></script>
    <script src="./scripts/utils.js"></script>

    <!-- Auth + page shell -->
    <script defer src="./scripts/auth.js"></script>
    <script defer src="./scripts/page.js"></script>

    <!-- Account logic -->
    <script defer src="./scripts/account.js"></script>
  </head>

  <body data-page="account" class="cc-body">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg cc-navbar sticky-top">
      <div class="container-xxl px-3">
        <a
          class="navbar-brand d-flex align-items-center gap-2"
          href="index.html"
        >
          <img
            class="cc-mark"
            src="./Images/CClogo1.png"
            alt="Crop Cart Logo IMG"
          />
          <span class="fw-bold">CropCart</span>
        </a>

        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#ccNav"
          aria-controls="ccNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="ccNav">
          <ul class="navbar-nav ms-auto gap-lg-2">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Store</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="cart.html">My Cart</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="farmer.html">Farmer Portal</a>
            </li>
            <li>
              <ul class="navbar-nav ms-auto gap-lg-2" id="authNav">
                <!-- JS opulates this -->
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <main class="container py-5">
      <!-- If logged OUT -->
      <section data-auth="out" class="d-none">
        <div class="cc-card">
          <h1 class="cc-h2 mb-2">My Account</h1>
          <p class="cc-sub mb-3">Please log in to view your account.</p>
          <a class="btn cc-btn" href="login.html">Go to login</a>
        </div>
      </section>

      <!-- If logged IN -->
      <section data-auth="in" class="d-none">
        <div
          class="d-flex flex-wrap align-items-end justify-content-between gap-3 mb-4"
        >
          <div>
            <h1 class="h3 fw-bold mb-1">My Account</h1>
          </div>
          <div id="pageStatus" class="small"></div>
        </div>

        <div class="row g-4">
          <!-- PROFILE -->
          <div class="col-lg-6">
            <div class="cc-card h-100">
              <div
                class="d-flex align-items-start justify-content-between gap-3 mb-2"
              >
                <div>
                  <h2 class="h5 fw-bold mb-1">Profile</h2>
                  <div class="text-muted small">
                    Your basic account details.
                  </div>
                </div>
                <button class="btn cc-btn-outline" id="logoutBtn" type="button">
                  Log out
                </button>
              </div>

              <hr class="cc-hr" />

              <form id="accountProfileForm" class="row g-3" novalidate>
                <div class="col-md-6">
                  <label class="form-label cc-label" for="accUsername"
                    >Username</label
                  >
                  <input
                    class="form-control cc-input"
                    id="accUsername"
                    disabled
                  />
                </div>

                <div class="col-md-6">
                  <label class="form-label cc-label" for="accEmail"
                    >Email</label
                  >

                  <div class="input-group">
                    <input
                      class="form-control cc-email-input"
                      id="accEmail"
                      type="email"
                      disabled
                    />
                    <button
                      class="btn cc-btn-outline"
                      id="openChangeEmailBtn"
                      type="button"
                      data-bs-toggle="modal"
                      data-bs-target="#changeEmailModal"
                    >
                      Change
                    </button>
                  </div>

                  <div class="form-text text-muted small">
                    Changing email requires authentication.
                  </div>
                </div>

                <div class="col-md-6">
                  <label class="form-label cc-label" for="accFirst"
                    >First name</label
                  >
                  <input
                    class="form-control cc-input"
                    id="accFirst"
                    placeholder="(optional)"
                  />
                </div>

                <div class="col-md-6">
                  <label class="form-label cc-label" for="accLast"
                    >Last name</label
                  >
                  <input
                    class="form-control cc-input"
                    id="accLast"
                    placeholder="(optional)"
                  />
                </div>

                <div class="col-12 d-grid d-sm-flex gap-2">
                  <button class="btn cc-btn" id="saveProfileBtn" type="submit">
                    Save
                  </button>
                </div>
              </form>
            </div>
          </div>

          <!-- DELIVERY DEFAULTS -->
          <div class="col-lg-6">
            <div class="cc-card h-100">
              <div
                class="d-flex align-items-start justify-content-between gap-3 mb-2"
              >
                <div>
                  <h2 class="h5 fw-bold mb-1">Delivery defaults</h2>
                  <div class="text-muted small">
                    Used to pre-fill in checkout.
                  </div>
                </div>
                <button
                  class="btn cc-btn"
                  id="editAddressBtn"
                  type="button"
                  data-bs-toggle="modal"
                  data-bs-target="#addressModal"
                >
                  Edit address
                </button>
              </div>

              <hr class="cc-hr" />

              <div id="addressSummary" class="small">
                <div class="text-muted">Loading delivery address…</div>
              </div>

              <hr class="cc-hr" />
            </div>
          </div>

          <div class="col-lg-7">
            <div class="cc-card h-100">
              <div
                id="FavoriteCard"
                class="d-flex align-items-start justify-content-between gap-3 mb-2"
              >
                <div>
                  <h2 class="h5 fw-bold mb-1">Favorite farms</h2>
                  <div class="text-muted small">
                    Farms you have starred in the store.
                  </div>
                </div>
                <button
                  class="btn cc-btn-outline"
                  id="refreshFavoritesBtn"
                  type="button"
                >
                  Refresh
                </button>
              </div>

              <hr class="cc-hr" />

              <div id="favoritesList" class="d-grid gap-2">
                <div class="text-muted small">Loading favorites…</div>
              </div>

              <div id="favoritesNote" class="small text-muted mt-3"></div>
            </div>
          </div>

          <!-- PROVIDER INFO (optional) -->
          <div class="col-lg-5">
            <div class="cc-card h-100">
              <div
                class="d-flex align-items-start justify-content-between gap-3 mb-2"
              >
                <div>
                  <h2 class="h5 fw-bold mb-1">Provider details</h2>
                  <div class="text-muted small">
                    If you own a farm, it’ll show up here.
                  </div>
                </div>
                <a class="btn cc-btn-outline" href="farmer.html"
                  >Open Farmer Portal</a
                >
              </div>

              <hr class="cc-hr" />

              <div
                id="providerBox"
                class="justify-content-center text-align-center small"
              >
                <div class="text-muted">Checking farm ownership…</div>
              </div>
            </div>
          </div>

          <!-- SECURITY -->
          <div class="col-12">
            <div class="cc-card">
              <h2 class="h5 fw-bold mb-1">Password Reset</h2>

              <form
                id="passwordResetForm"
                class="row g-2 align-items-end"
                novalidate
              >
                <div class="col-md-6">
                  <label class="form-label cc-label" for="resetEmail"
                    >Confirm Your Email</label
                  >
                  <input
                    class="form-control cc-input"
                    id="resetEmail"
                    type="email"
                    required
                  />
                </div>
                <div class="col-md-6 d-grid">
                  <button class="btn cc-btn" id="sendResetBtn" type="submit">
                    Send password reset email
                  </button>
                </div>
              </form>

              <div id="securityStatus" class="small mt-3"></div>
            </div>
          </div>

          <!-- DANGER ZONE -->
          <div class="col-12">
            <div class="cc-card border border-danger-subtle">
              <h2 class="h5 fw-bold mb-1 text-danger">Danger zone</h2>
              <div class="text-muted small mb-3">
                Warning: Deleting your account is permanent. Please be aware of
                the risks before you do so.
              </div>

              <button
                class="btn btn-outline-danger"
                id="deleteAccountBtn"
                type="button"
              >
                Delete my account
              </button>

              <div id="dangerStatus" class="small mt-3"></div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Address Modal -->
    <div class="modal fade" id="addressModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Delivery address</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>

          <form id="addressForm" novalidate>
            <div class="modal-body">
              <div class="row g-3">
                <div class="col-12">
                  <label class="form-label fw-semibold" for="addrLine1"
                    >Address</label
                  >
                  <input
                    class="form-control"
                    id="addrLine1"
                    autocomplete="street-address"
                    required
                  />
                </div>

                <div class="col-md-6">
                  <label class="form-label fw-semibold" for="addrCity"
                    >City</label
                  >
                  <input
                    class="form-control"
                    id="addrCity"
                    autocomplete="address-level2"
                    required
                  />
                </div>

                <div class="col-md-3">
                  <label class="form-label fw-semibold" for="addrState"
                    >State</label
                  >
                  <input
                    class="form-control"
                    id="addrState"
                    autocomplete="address-level1"
                    required
                  />
                </div>

                <div class="col-md-3">
                  <label class="form-label fw-semibold" for="addrZip"
                    >Zip</label
                  >
                  <input
                    class="form-control"
                    id="addrZip"
                    autocomplete="postal-code"
                    inputmode="numeric"
                    required
                  />
                </div>

                <div class="col-12">
                  <div class="alert alert-info small mb-0">
                    This will be used as your “default” delivery address on this
                    device.
                  </div>
                </div>

                <div class="col-12">
                  <div id="addressModalStatus" class="small"></div>
                </div>
              </div>
            </div>

            <div class="modal-footer">
              <button
                type="button"
                class="btn cc-btn-outline"
                data-bs-dismiss="modal"
              >
                Cancel
              </button>
              <button class="btn cc-btn" id="saveAddressBtn" type="submit">
                Save address
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Change Email Modal -->
    <div
      class="modal fade"
      id="changeEmailModal"
      tabindex="-1"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Change email</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>

          <form id="changeEmailForm" novalidate>
            <div class="modal-body">
              <div class="row g-3">
                <div class="col-12">
                  <label class="form-label fw-semibold" for="newEmail"
                    >New Email</label
                  >
                  <input
                    class="form-control"
                    id="newEmail"
                    type="email"
                    autocomplete="email"
                    required
                  />
                </div>

                <div class="col-12">
                  <label class="form-label fw-semibold" for="confirmPassword"
                    >Current Password</label
                  >
                  <input
                    class="form-control"
                    id="confirmPassword"
                    type="password"
                    autocomplete="current-password"
                    required
                  />
                </div>

                <div class="col-12">
                  <div id="changeEmailStatus" class="small"></div>
                </div>
              </div>
            </div>

            <div class="modal-footer">
              <button
                type="button"
                class="btn cc-btn-outline"
                data-bs-dismiss="modal"
              >
                Cancel
              </button>
              <button class="btn cc-btn" id="saveEmailBtn" type="submit">
                Update email
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS (needed for modal) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
